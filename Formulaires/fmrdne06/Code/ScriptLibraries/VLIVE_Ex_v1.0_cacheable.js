// jQuery$(document).ready(function() {	if($('#f_Etat').val() >= 4) {		// Si il y a des ressources (éditables en saisie initiale)		if(arrSitesDistants.length > 0) {			jQuery.each(arrSitesDistants, function(i, val) {				VLIVE_BuildSiteBlock(val, $("#DisplayMode").val() == "VALID_E4", $("#DisplayMode").val() == "VALID_E4");			});		}	}});// Annulationvar FormHasBeenSent = false;function VLIVE_Cancelled() {	if(FormHasBeenSent) return false;	if(confirm(l_Conf_Cancel)) {		FormHasBeenSent = true;		$("#f_ActionAFaire").val("annuler");		document.forms[0].submit();	}}// Réengagerfunction VLIVE_Reengager() {	if(FormHasBeenSent) return false;	if(confirm(l_Conf_Reengage)) {		FormHasBeenSent = true;		var URL = window.location.href;		var Proto = URL.substring(0, URL.indexOf("://"));		var Domain = URL.substring(URL.indexOf("://") + 3, URL.length);		Domain = Domain.substring(0, Domain.indexOf("/"));		window.location.href = Proto + "://" + Domain + "/" + URLReengager;	}}// Construction d'un bloc d'une ressourcefunction VLIVE_BuildSiteBlock(pSite, pEditable, pDeletable) {	var DBPath = window.location.href.substring(0, window.location.href.indexOf(".nsf") + 4);	var intIndex = $("#VLIVE_E4_Sites table.VLIVE_Sites").length + 1;	var strDisplayMode = $("#DisplayMode").val().toUpperCase();	// Si une site est en paramètre	if(pSite) {		var strSitesSite = pSite.SitesSite.toUpperCase();		var strSitesNombre = pSite.SitesNombre;		var strSitesCorrespondants = pSite.SitesCorrespondants;	}	else {		var strSitesSite = "";		var strSitesNombre = "";		var strSitesCorrespondants = "";	}	// Tableau et colonne	var HTML = "<table cellspacing=\"0\" cellpadding=\"2\" class=\"VLIVE_Sites\" id=\"VLIVE_Sites_" + intIndex + "\">";	HTML += "<colgroup><col width=\"16\"><col width=\"173\"><col width=\"189\"><col width=\"16\"><col width=\"173\"><col width=\"189\"></colgroup>";		// Ligne d'entête	HTML += "<tr><th></th><th colspan=\"5\">";	if(pDeletable) HTML += "<span style=\"float: right;\" class=\"buttons\"><img src=\"/icons/vwtrash.gif\" style=\"cursor: pointer; margin-left: 5px;\" class=\"delete\" onClick=\"VLIVE_RemoveSiteBlock(this);\"></span>";	HTML += "<span class=\"text\">" + l_VLIVE_E4_SitesNumberX + intIndex + "</span>";	HTML += "</th></tr>";	// Nom du site distant	HTML += "<tr>";	if(pEditable)		HTML += "<td><img width=\"16\" height=\"16\" src=\"" + DBPath + "/mandatoryfield_cacheable.gif?OpenImageResource\"></td>";	else		HTML += "<td></td>";	HTML += "<td class=\"FieldLegend\">" + l_VLIVE_E4_SitesDistants + "&nbsp;:</td>";	HTML += "<td colspan=\"4\">"	if(pEditable) {		HTML += "<select id=\"VLIVE_SitesSite_" + intIndex + "\" name=\"VLIVE_SitesSite\">";		HTML += "<option value=\"\"></option>";		jQuery.each(arrSites, function(i, val) {			HTML += "<option value=\""+ i +"\"" + (strSitesSite == i ? " selected" : "") + ">" + val + "</option>";		});		HTML += "</select>";	}	else {		HTML += Forms_Sites[strSitesSite];	}	HTML += "</td>";	HTML += "</tr>";	// Nombre de personnes à suivre l’événement depuis le site	HTML += "<tr>";	if(pEditable)		HTML += "<td><img width=\"16\" height=\"16\" src=\"" + DBPath + "/mandatoryfield_cacheable.gif?OpenImageResource\"></td>";	else		HTML += "<td></td>";	HTML += "<td class=\"FieldLegend\">" + l_VLIVE_E4_NombrePersonnes + "&nbsp;:</td>";	HTML += "<td colspan=\"3\">"	if(pEditable)		HTML += "<input id=\"VLIVE_SitesNombre_" + intIndex + "\" name=\"VLIVE_SitesNombre\" value=\"" + strSitesNombre + "\" class=\"Integer\">";	else		HTML += strSitesNombre;	HTML += "</td>";	HTML += "<td></td>";	HTML += "</tr>";	// Correspondants	HTML += "<tr>";	if(pEditable)		HTML += "<td><img width=\"16\" height=\"16\" src=\"" + DBPath + "/mandatoryfield_cacheable.gif?OpenImageResource\"></td>";	else		HTML += "<td></td>";	HTML += "<td class=\"FieldLegend\">" + l_VLIVE_E4_Correspondants + "&nbsp;:</td>";	HTML += "<td colspan=\"3\">"	if(pEditable) {		HTML += "<textarea rows=\"4\" style=\"width: 100%;\" id=\"VLIVE_SitesCorrespondants_" + intIndex + "\" name=\"VLIVE_SitesCorrespondants\" value=\"" + strSitesCorrespondants + "\" onFocus=\"blur()\" class=\"ui-widget-content ui-resizable\"></textarea>";		HTML += "</td>";		HTML += "<td><a href=\"javascript:VLIVE_SiteNamePicker(" + intIndex + ");\"><img src=\""+DBPath+"/namepicker_cacheable.gif?openimageresource\" border=\"0\"></a></td>";	}	else {		HTML += strSitesCorrespondants.split(",").join("<br />");		//HTML += strSitesCorrespondants;		HTML += "</td>";		HTML += "<td></td>";	}	HTML += "</tr>";		// Bug IE: il faut une ligne sans colspan pour concerver les tailles de colonnes	HTML += "<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>";	HTML += "</table>";	// Mode édition, données à renvoyer	if(!pEditable && (strDisplayMode == "EDIT"))	 {		HTML += "<input type=\"hidden\" id=\"VLIVE_SitesSite_" + intIndex + "\" name=\"VLIVE_SitesSite\" value=\"" + strSitesSite + "\">";		HTML += "<input type=\"hidden\" id=\"VLIVE_SitesNombre_" + intIndex + "\" name=\"VLIVE_SitesNombre\" value=\"" + strSitesNombre + "\">";		HTML += "<input type=\"hidden\" id=\"VLIVE_SitesCorrespondants_" + intIndex + "\" name=\"VLIVE_SitesCorrespondants\" value=\"" + strSitesCorrespondants + "\">";	}			// Ajout au formulaire	$("#VLIVE_E4_Sites").append(HTML);		// Defines actions for the Integer class	// Appuye sur une touche	$(".Integer").keypress(function(e) {		if(!IsSpecialKey(e)) {					// Caract\u00E8re autre que [0-9]			if((e.which < 48) || (e.which > 57)) {				e.preventDefault();			}		}	});	// Changement de la valeur (copier-coller par exemple)	$(".Integer").change(function() {		// Uniquement [0-9]		$(this).val($(this).val().replace(/[^0-9]/gi, ""));			});		// Définition des textareas redimentionnables	$("textarea").addClass("ui-widget-content").resizable( { handles: "s", minHeight: 50 });	}function VLIVE_SiteNamePicker(intIndex) {	NamePicker({		Multiple: true,		MultipleSeparator: ",",		Type: new Array("Person"),		CallBackFields: new Array("AbbreviatedName"),		OKCallBackFunction: function (SelectedNames) {					var DisplayName = "";			for(key in SelectedNames) {				DisplayName = DisplayName + SelectedNames[key] + ", ";			}			$("#VLIVE_SitesCorrespondants_" + intIndex).val(DisplayName.substring(0, DisplayName.length - "\n".length));		},		MultipleInitialisationValue: $("#VLIVE_SitesCorrespondants_" + intIndex).val().split("\n")	});}// Changement de demandeurfunction VLIVE_ChangeRequester() {	NamePicker({		Type: new Array("Person"),		CallBackFields: new Array("AbbreviatedName"),		OKCallBackFunction: function(SelectedName) {			if(confirm(l_Conf_ChangeRequester)) {				if($("#f_Demandeur").length != 0) // Existance d'un champ demandeur					$("#f_Demandeur").val(SelectedName[0].AbbreviatedName);				else // Création d'un champ de toutes pièces					$("form").eq(0).append("<input type=\"hidden\" id=\"f_Demandeur\" name=\"f_Demandeur\" value=\"" + SelectedName[0].AbbreviatedName + "\">");					$("#f_ActionAFaire").val("ChangeRequester");				document.forms[0].submit();			}			else return false;		}	});}// Changement des backups demandeurfunction VLIVE_ChangeRequesterBackup() {	NamePicker({		Multiple: true,		MultipleSeparator: "\n",		Type: new Array("Person"),		CallBackFields: new Array("AbbreviatedName"),		OKCallBackFunction: function (SelectedNames) {					// Backup != demandeur			if(jQuery.inArray(jQuery.trim(Form["Requester"]["AbbreviatedName"]), SelectedNames) != -1) { alert(l_Forms_Err_RequesterCantBeOwnBackup); return false; }			// Backup != valideurs			if((SelectedNames.sort().join().toUpperCase() !== Form["Requester"]["Backup"].sort().join().toUpperCase()) && confirm(l_Conf_ChangeRequesterBackup)) {				if($("#Forms_RequesterBackup").length != 0) // Existance d'un champ					$("#Forms_RequesterBackup").val(SelectedNames.join("\n"));				else // Création d'un champ de toutes pièces					$("form").eq(0).append("<input type=\"hidden\" id=\"Forms_RequesterBackup\" name=\"Forms_RequesterBackup\" value=\"" + SelectedNames.join("\n") + "\">");				$("#f_ActionAFaire").val("ChangeRequesterBackup");				document.forms[0].submit();			}			else return false;		},		MultipleInitialisationValue: Form["Requester"]["Backup"]	});}